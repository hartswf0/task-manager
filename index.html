<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Zapper: Mars Mission Edition</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #ff4500;
            --secondary-color: #1e90ff;
            --background-color: #1c1c1c;
            --text-color: #e0e0e0;
            --task-bg-color: #2a2a2a;
            --accent-color: #32cd32;
            --high-priority: #ff0000;
            --medium-priority: #ffa500;
            --low-priority: #ffff00;
        }

        body {
            font-family: 'Roboto Mono', monospace;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--background-color);
            margin: 0;
            padding: 20px;
            max-width: 100%;
            overflow-x: hidden;
        }

        h1, h2 {
            color: var(--primary-color);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .task-board {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 20px;
        }

        .column {
            flex: 1;
            background-color: var(--task-bg-color);
            border-radius: 10px;
            padding: 15px;
            min-height: 300px;
        }

        .column h2 {
            text-align: center;
            color: var(--secondary-color);
        }

        .task {
            background-color: var(--background-color);
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
            cursor: move;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .task:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .task h3 {
            margin-top: 0;
            color: var(--secondary-color);
        }

        .task-actions {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }

        .task-actions button {
            background-color: var(--secondary-color);
            color: var(--text-color);
            border: none;
            padding: 3px 6px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .priority-high {
            border-left: 5px solid var(--high-priority);
        }

        .priority-medium {
            border-left: 5px solid var(--medium-priority);
        }

        .priority-low {
            border-left: 5px solid var(--low-priority);
        }

        .floating-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--accent-color);
            color: var(--background-color);
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: transform 0.3s;
        }

        .floating-button:hover {
            transform: scale(1.1);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: var(--task-bg-color);
            margin: 15% auto;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 500px;
        }

        .modal-content input, .modal-content select {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            border: 1px solid var(--secondary-color);
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .modal-content button {
            background-color: var(--accent-color);
            color: var(--background-color);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }

        #statusBar {
            background-color: var(--task-bg-color);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #batteryStatus {
            display: flex;
            align-items: center;
        }

        #batteryIcon {
            width: 30px;
            height: 15px;
            border: 2px solid var(--text-color);
            border-radius: 3px;
            position: relative;
            margin-right: 5px;
        }

        #batteryLevel {
            height: 100%;
            background-color: var(--accent-color);
            transition: width 0.3s;
        }

        #batteryPercentage {
            margin-left: 5px;
        }

        #emergencyButton {
            background-color: var(--high-priority);
            color: var(--text-color);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.3s;
        }

        #emergencyButton:hover {
            transform: scale(1.05);
        }

        @media (max-width: 768px) {
            .task-board {
                flex-direction: column;
            }

            .column {
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <h1>Task Zapper: Mars Mission Edition</h1>

    <div id="statusBar">
        <div id="batteryStatus">
            <div id="batteryIcon"><div id="batteryLevel"></div></div>
            <span id="batteryPercentage">100%</span>
        </div>
        <button id="emergencyButton">EMERGENCY</button>
    </div>

    <div class="task-board">
        <div class="column" id="todo">
            <h2>To Do</h2>
        </div>
        <div class="column" id="inProgress">
            <h2>In Progress</h2>
        </div>
        <div class="column" id="done">
            <h2>Done</h2>
        </div>
    </div>

    <button class="floating-button" onclick="openModal()">+</button>

    <div id="taskModal" class="modal">
        <div class="modal-content">
            <input type="text" id="taskName" placeholder="Task name">
            <input type="date" id="taskDate">
            <select id="taskPriority">
                <option value="low">Low Priority</option>
                <option value="medium">Medium Priority</option>
                <option value="high">High Priority</option>
            </select>
            <select id="taskAssignee">
                <option value="unassigned">Unassigned</option>
                <option value="astronaut1">Astronaut 1</option>
                <option value="astronaut2">Astronaut 2</option>
                <option value="astronaut3">Astronaut 3</option>
            </select>
            <button onclick="addTask()">Add Task</button>
        </div>
    </div>

    <script>
        let tasks = [];
        let draggedTask = null;

        function openModal() {
            document.getElementById('taskModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('taskModal').style.display = 'none';
        }

        function addTask() {
            const taskName = document.getElementById('taskName').value.trim();
            const taskDate = document.getElementById('taskDate').value;
            const taskPriority = document.getElementById('taskPriority').value;
            const taskAssignee = document.getElementById('taskAssignee').value;

            if (taskName) {
                const newTask = { 
                    id: Date.now(),
                    name: taskName, 
                    date: taskDate, 
                    priority: taskPriority,
                    assignee: taskAssignee,
                    status: 'todo'
                };
                tasks.push(newTask);
                updateTaskBoard();
                closeModal();
                document.getElementById('taskName').value = '';
                document.getElementById('taskDate').value = '';
                document.getElementById('taskPriority').value = 'low';
                document.getElementById('taskAssignee').value = 'unassigned';
            }
        }

        function updateTaskBoard() {
            const columns = ['todo', 'inProgress', 'done'];
            columns.forEach(column => {
                const columnElement = document.getElementById(column);
                columnElement.innerHTML = `<h2>${column === 'inProgress' ? 'In Progress' : column.charAt(0).toUpperCase() + column.slice(1)}</h2>`;
                tasks.filter(task => task.status === column).forEach(task => {
                    const taskElement = createTaskElement(task);
                    columnElement.appendChild(taskElement);
                });
            });
            saveTasksToLocalStorage();
        }

        function createTaskElement(task) {
            const taskElement = document.createElement('div');
            taskElement.classList.add('task', `priority-${task.priority}`);
            taskElement.setAttribute('draggable', true);
            taskElement.id = `task-${task.id}`;
            taskElement.innerHTML = `
                <h3>${task.name}</h3>
                <p>Date: ${task.date || 'Not set'}</p>
                <p>Assignee: ${task.assignee}</p>
                <div class="task-actions">
                    <button onclick="editTask(${task.id})">Edit</button>
                    <button onclick="deleteTask(${task.id})">Delete</button>
                </div>
            `;
            taskElement.addEventListener('dragstart', dragStart);
            taskElement.addEventListener('dragend', dragEnd);
            return taskElement;
        }

        function dragStart(e) {
            draggedTask = e.target;
            e.dataTransfer.setData('text/plain', e.target.id);
            setTimeout(() => e.target.style.display = 'none', 0);
        }

        function dragEnd(e) {
            draggedTask.style.display = 'block';
            draggedTask = null;
        }

        document.querySelectorAll('.column').forEach(column => {
            column.addEventListener('dragover', dragOver);
            column.addEventListener('dragenter', dragEnter);
            column.addEventListener('dragleave', dragLeave);
            column.addEventListener('drop', drop);
        });

        function dragOver(e) {
            e.preventDefault();
        }

        function dragEnter(e) {
            e.preventDefault();
            if (e.target.classList.contains('column')) {
                e.target.style.background = 'rgba(0, 0, 0, 0.2)';
            }
        }

        function dragLeave(e) {
            if (e.target.classList.contains('column')) {
                e.target.style.background = '';
            }
        }

        function drop(e) {
            e.preventDefault();
            const column = e.target.closest('.column');
            column.style.background = '';
            const taskId = e.dataTransfer.getData('text').split('-')[1];
            const task = tasks.find(t => t.id === parseInt(taskId));
            if (task) {
                task.status = column.id;
                updateTaskBoard();
            }
        }

        function editTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                document.getElementById('taskName').value = task.name;
                document.getElementById('taskDate').value = task.date;
                document.getElementById('taskPriority').value = task.priority;
                document.getElementById('taskAssignee').value = task.assignee;
                openModal();
                // Remove the old task and add the updated one when the modal is closed
                const oldAddTask = window.addTask;
                window.addTask = function() {
                    tasks = tasks.filter(t => t.id !== taskId);
                    oldAddTask();
                    window.addTask = oldAddTask;
                };
            }
        }

        function deleteTask(taskId) {
            tasks = tasks.filter(task => task.id !== taskId);
            updateTaskBoard();
        }

        function saveTasksToLocalStorage() {
            localStorage.setItem('marsMissionTasks', JSON.stringify(tasks));
        }

        function loadTasksFromLocalStorage() {
            const storedTasks = localStorage.getItem('marsMissionTasks');
            if (storedTasks) {
                tasks = JSON.parse(storedTasks);
                updateTaskBoard();
            }
        }

        // Battery status simulation
        function updateBatteryStatus() {
            const batteryLevel = document.getElementById('batteryLevel');
            const batteryPercentage = document.getElementById('batteryPercentage');
            let level = 100;
            setInterval(() => {
                level = Math.max(0, level - 1);
                batteryLevel.style.width = `${level}%`;
                batteryPercentage.textContent = `${level}%`;
                if (level < 20) {
                    document.body.classList.add('low-power-mode');
                } else {
                    document.body.classList.remove('low-power-mode');
                }
            }, 60000); // Update every minute
        }

        // Emergency mode
        document.getElementById('emergencyButton').addEventListener('click', () => {
            tasks = [];
            updateTaskBoard();
            alert('EMERGENCY MODE ACTIVATED. All tasks cleared. Follow critical procedures.');
        });

        // Initialize
        loadTasksFromLocalStorage();
        updateBatteryStatus();

        // Service Worker for offline functionality
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(registration => console.log('Service Worker registered'))
                .catch(error => console.log('Service Worker registration failed:', error));
        }
    </script>
</body>
</html>